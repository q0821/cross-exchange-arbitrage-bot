# Quickstart: 分單開倉（獨立持倉）

**Feature**: 060-split-position-open
**Date**: 2026-01-07

## 功能概述

分單開倉允許用戶將一個大額開倉操作拆分為多個小額獨立持倉，減少滑價並支援分批管理。

## 使用方式

### 1. 開啟開倉對話框

在市場監控頁面，點擊任一套利機會的「開倉」按鈕。

### 2. 設定開倉參數

| 參數 | 說明 | 範例 |
|------|------|------|
| 總數量 | 要開倉的總數量 | 600 |
| **開倉組數** | 拆分為幾個獨立持倉（1-10） | 2 |
| 槓桿 | 1x 或 2x | 2x |
| 停損 | 是否啟用及百分比 | 開啟, 5% |
| 停利 | 是否啟用及百分比 | 開啟, 3% |

### 3. 確認每組數量

系統會自動計算並顯示每組的數量：

```
總數量：600
開倉組數：2
每組數量：300
```

### 4. 執行開倉

點擊「確認開倉」後，系統會串行建立每組持倉：

```
[1/2] 正在建立第 1 組持倉... ✓
[2/2] 正在建立第 2 組持倉... ✓
開倉完成！共建立 2 個獨立持倉
```

### 5. 管理持倉

在持倉頁面，每組持倉獨立顯示，可以：
- 單獨查看每組的損益
- 單獨調整停損停利
- 單獨平倉（部分獲利了結）

## 功能測試

### 測試 1: 基本分單開倉

1. 選擇一個套利機會
2. 設定總數量 100，開倉組數 2
3. 確認開倉
4. 驗證持倉頁面顯示 2 個獨立持倉，各 50 數量

### 測試 2: 不可整除數量分配

1. 設定總數量 100，開倉組數 3
2. 確認開倉
3. 驗證分配結果：34 + 33 + 33 = 100

### 測試 3: 最小數量驗證

1. 設定總數量 0.0003，開倉組數 5
2. 預期：顯示錯誤「每組數量不得小於 0.0001」

### 測試 4: 組數為 1（退化測試）

1. 設定開倉組數為 1
2. 確認開倉
3. 驗證行為與原本單一開倉完全相同

### 測試 5: 部分失敗處理

1. 設定開倉 3 組
2. 模擬第 2 組餘額不足
3. 預期：
   - 第 1 組持倉成功建立
   - 顯示「已完成 1/3 組，第 2 組失敗：餘額不足」
   - 第 1 組持倉可正常操作

## 驗收標準

- [ ] 開倉對話框顯示「開倉組數」輸入欄位
- [ ] 組數範圍 1-10，預設為 1
- [ ] 即時顯示每組預估數量
- [ ] 串行執行，顯示進度（第 N/M 組）
- [ ] 每組持倉在持倉列表獨立顯示
- [ ] 部分失敗時已成功持倉可正常操作
- [ ] 組數為 1 時行為與單一開倉相同

## 常見問題

### Q: 分單開倉會比較慢嗎？

是的，因為採用串行執行（第 1 組完成後才開第 2 組），所以總執行時間約為單次開倉時間 × 組數。

### Q: 可以同時開多個不同交易對嗎？

不行，分單開倉只針對單一交易對。如需開多個交易對，請分別操作。

### Q: 中間失敗了怎麼辦？

已成功建立的持倉會保留並正常運作。您可以修正問題後重新開啟剩餘組數。
