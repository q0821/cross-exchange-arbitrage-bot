# Feature Specification: 統一 UI 主題系統

**Feature Branch**: `046-unified-ui-theme`
**Created**: 2025-12-28
**Status**: Draft
**Input**: UI/UX 全站調整 - 統一跨交易所套利交易平台的視覺風格

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 主題偏好自動適應 (Priority: P1)

用戶首次進入交易平台時，系統自動偵測其作業系統的深淺色偏好設定，並套用相應的視覺主題。當用戶在作業系統層級切換主題時，平台立即響應並同步更新顯示效果。

**Why this priority**: 這是最基礎的用戶體驗改善，解決目前頁面配色不一致的核心問題，確保用戶在任何系統偏好下都能獲得一致的視覺體驗。

**Independent Test**: 可透過切換作業系統主題設定，驗證平台是否即時響應並正確顯示對應主題。

**Acceptance Scenarios**:

1. **Given** 用戶的作業系統設定為深色模式, **When** 用戶首次訪問平台, **Then** 平台自動顯示深色主題，所有頁面呈現一致的深色視覺風格
2. **Given** 用戶正在使用平台且系統為淺色模式, **When** 用戶切換作業系統至深色模式, **Then** 平台在 1 秒內同步切換為深色主題，無需重新整理頁面
3. **Given** 用戶的作業系統設定為「自動」(日間淺色/夜間深色), **When** 系統時間進入夜間模式, **Then** 平台自動切換為深色主題

---

### User Story 2 - 一致的視覺體驗 (Priority: P1)

用戶在瀏覽平台的不同頁面時（資產總覽、市場監控、持倉管理、交易歷史、設定），所有頁面呈現統一的視覺風格：相同的色彩體系、卡片樣式、字體配置和間距規範。

**Why this priority**: 直接解決目前資產總覽頁面與其他頁面配色不一致的問題，是本次改動的核心目標。

**Independent Test**: 逐一瀏覽所有頁面，檢查背景色、卡片樣式、文字顏色是否保持一致。

**Acceptance Scenarios**:

1. **Given** 用戶位於市場監控頁面, **When** 用戶導航至資產總覽頁面, **Then** 兩個頁面的背景色、卡片樣式、文字顏色風格一致
2. **Given** 平台處於深色模式, **When** 用戶瀏覽所有六個主要頁面, **Then** 每個頁面都使用相同的深色配色方案
3. **Given** 平台處於淺色模式, **When** 用戶瀏覽所有六個主要頁面, **Then** 每個頁面都使用相同的淺色配色方案

---

### User Story 3 - 手動主題切換 (Priority: P2)

用戶可在平台導航列中找到主題切換控制，點擊後可選擇「淺色」、「深色」或「跟隨系統」三種模式。選擇後偏好設定將被記住，下次訪問時自動套用。

**Why this priority**: 提供用戶自主控制權，某些用戶可能希望在特定環境使用與系統設定不同的主題。

**Independent Test**: 透過點擊主題切換按鈕並重新整理頁面，驗證偏好設定是否被正確保存並套用。

**Acceptance Scenarios**:

1. **Given** 用戶位於任意頁面, **When** 用戶點擊導航列的主題切換按鈕, **Then** 顯示三個選項：淺色模式、深色模式、跟隨系統
2. **Given** 用戶選擇「深色模式」, **When** 用戶關閉瀏覽器並重新開啟平台, **Then** 平台自動以深色模式顯示，忽略系統設定
3. **Given** 用戶選擇「跟隨系統」, **When** 用戶的系統偏好改變, **Then** 平台重新開始響應系統偏好變化

---

### User Story 4 - Glassmorphism 毛玻璃視覺效果 (Priority: P2)

用戶看到的卡片、面板等 UI 元件採用半透明背景配合模糊效果（毛玻璃效果），呈現現代化、有層次感的視覺設計。

**Why this priority**: 提升視覺品質和現代感，但不影響核心功能使用，屬於體驗增強。

**Independent Test**: 檢查卡片元件是否具有半透明背景和背景模糊效果。

**Acceptance Scenarios**:

1. **Given** 用戶查看資產總覽頁面的總資產卡片, **When** 卡片後方有其他內容, **Then** 可透過卡片半透明背景隱約看到後方內容的模糊影像
2. **Given** 用戶在市場監控頁面查看統計卡片, **When** 頁面捲動使背景變化, **Then** 卡片的毛玻璃效果隨背景變化產生動態視覺層次
3. **Given** 用戶使用不支援 backdrop-filter 的舊版瀏覽器, **When** 用戶訪問平台, **Then** 卡片顯示為純色背景作為降級方案，功能不受影響

---

### User Story 5 - Bento Grid 版面佈局 (Priority: P3)

用戶看到的儀表板頁面（特別是資產總覽）採用 Bento Grid 版面設計，卡片大小不一、錯落有致，重要資訊佔據更大空間，次要資訊以較小卡片呈現。

**Why this priority**: 提升資訊層級的視覺表達，屬於進階體驗優化。

**Independent Test**: 檢查資產總覽頁面是否呈現大小不一的卡片佈局。

**Acceptance Scenarios**:

1. **Given** 用戶訪問資產總覽頁面, **When** 頁面載入完成, **Then** 總資產卡片佔據較大空間，各交易所餘額卡片以較小尺寸排列
2. **Given** 用戶在桌面裝置查看頁面, **When** 視窗寬度大於 1024px, **Then** 顯示完整的 Bento Grid 佈局
3. **Given** 用戶在行動裝置查看頁面, **When** 視窗寬度小於 768px, **Then** 佈局自動調整為單欄堆疊，保持可讀性

---

### Edge Cases

- 當瀏覽器不支援 CSS backdrop-filter 時，卡片應降級為純色背景
- 當用戶清除瀏覽器儲存資料時，主題偏好應重置為「跟隨系統」
- 當系統偏好 API 不可用時，預設使用淺色主題
- 當 JavaScript 禁用時，頁面應顯示淺色主題（無主題切換功能）
- 主題切換過程中不應出現畫面閃爍（Flash of Unstyled Content）

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統 MUST 偵測用戶作業系統的深淺色偏好設定
- **FR-002**: 系統 MUST 在用戶首次訪問時自動套用系統偏好對應的主題
- **FR-003**: 系統 MUST 在作業系統偏好變化時即時響應並切換主題
- **FR-004**: 系統 MUST 提供主題切換控制元件，包含三個選項：淺色、深色、跟隨系統
- **FR-005**: 系統 MUST 將用戶的主題偏好儲存至瀏覽器本地儲存
- **FR-006**: 系統 MUST 在用戶重新訪問時載入已儲存的主題偏好
- **FR-007**: 所有頁面 MUST 使用統一的色彩變數系統
- **FR-008**: 深色模式 MUST 使用深色背景 (#0F172A) 搭配淺色文字
- **FR-009**: 淺色模式 MUST 使用淺色背景 (#F8F9FA) 搭配深色文字
- **FR-010**: 主色 MUST 為 #3B82F6 (Blue-500)，次色 MUST 為 #F59E11 (Amber)
- **FR-011**: 卡片元件 MUST 具有半透明背景和模糊效果（Glassmorphism）
- **FR-012**: 系統 MUST 為不支援 backdrop-filter 的瀏覽器提供降級方案
- **FR-013**: 資產總覽頁面 MUST 採用 Bento Grid 版面佈局
- **FR-014**: 版面 MUST 在不同螢幕尺寸下響應式調整
- **FR-015**: 色彩對比度 MUST 符合 WCAG 2.1 AA 標準（最小 4.5:1）
- **FR-016**: 主題切換過程 MUST 避免畫面閃爍
- **FR-017**: 所有元件圓角 MUST 使用 8px
- **FR-018**: 獲利數值 MUST 顯示為綠色，虧損數值 MUST 顯示為紅色

### Key Entities

- **Theme**: 代表主題設定，包含模式（light/dark/system）和對應的色彩配置
- **ColorScheme**: 色彩方案定義，包含背景色、前景色、主色、次色、語意色彩等
- **GlassCard**: 毛玻璃卡片元件，具有半透明背景和模糊效果屬性
- **ThemePreference**: 用戶主題偏好，儲存於瀏覽器本地儲存

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 所有六個主要頁面在深色模式下呈現 100% 一致的配色風格
- **SC-002**: 所有六個主要頁面在淺色模式下呈現 100% 一致的配色風格
- **SC-003**: 主題切換響應時間低於 200 毫秒，無視覺延遲感
- **SC-004**: 用戶偏好設定在關閉瀏覽器後 100% 被正確保留
- **SC-005**: 所有文字與背景的色彩對比度達到 WCAG 2.1 AA 標準（4.5:1 以上）
- **SC-006**: 響應式佈局在 320px 至 2560px 螢幕寬度範圍內正常顯示
- **SC-007**: 頁面初次載入時無主題閃爍現象（FOUC）
- **SC-008**: 在不支援 backdrop-filter 的瀏覽器中，毛玻璃效果降級為純色背景，不影響功能使用

## Assumptions

- 用戶使用現代瀏覽器（Chrome 76+、Firefox 70+、Safari 14+、Edge 79+）
- 專案已使用 Tailwind CSS 和 CSS 變數系統
- 專案已配置 darkMode: ['class'] 支援
- 用戶裝置支援 prefers-color-scheme 媒體查詢
- localStorage 可用於儲存用戶偏好
