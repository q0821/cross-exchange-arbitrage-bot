# Quickstart: 開倉停損停利設定

## 概述

本功能在開倉時自動設定停損停利條件單，防止單邊爆倉造成巨額虧損。

---

## 使用流程

### 1. 設定預設值（可選）

在 Settings > Trading 頁面設定停損停利預設值：

1. 進入設定頁面 `/settings/trading`
2. 設定預設停損百分比（建議 5%）
3. 設定預設停利百分比（建議 3%）
4. 選擇是否預設啟用停損/停利
5. 儲存設定

### 2. 開倉時設定停損停利

在 Market Monitor 頁面開倉：

1. 點擊交易對的「開倉」按鈕
2. 輸入開倉數量和槓桿
3. **停損設定**：
   - 開啟「停損」開關
   - 輸入停損百分比（0.5% - 50%）
   - 系統顯示計算後的觸發價格
4. **停利設定**（可選）：
   - 開啟「停利」開關
   - 輸入停利百分比（0.5% - 100%）
   - 系統顯示計算後的觸發價格
5. 確認開倉

### 3. 查看已設定的停損停利

在 Positions 頁面查看持倉：

- 每個持倉卡片顯示：
  - 停損價格（紅色）
  - 停利價格（綠色）
  - 條件單設定狀態

---

## 價格計算

### Long 倉位

```
停損價格 = 開倉均價 × (1 - 停損百分比 / 100)
停利價格 = 開倉均價 × (1 + 停利百分比 / 100)
```

### Short 倉位

```
停損價格 = 開倉均價 × (1 + 停損百分比 / 100)
停利價格 = 開倉均價 × (1 - 停利百分比 / 100)
```

### 範例

- 開倉價格：$50,000
- 停損百分比：5%
- 停利百分比：3%

| 倉位 | 停損價格 | 停利價格 |
|------|----------|----------|
| Long | $47,500 | $51,500 |
| Short | $52,500 | $48,500 |

---

## 狀態說明

| 狀態 | 說明 |
|------|------|
| PENDING | 尚未設定條件單 |
| SETTING | 正在設定條件單 |
| SET | 所有條件單設定成功 |
| PARTIAL | 部分條件單設定成功（需注意） |
| FAILED | 條件單設定失敗（需手動處理） |

---

## 錯誤處理

### 條件單設定失敗

如果條件單設定失敗：

1. 開倉仍然成功（不會回滾）
2. 系統顯示警告訊息
3. 建議在交易所手動設定停損停利

### 常見錯誤

| 錯誤 | 原因 | 解決方案 |
|------|------|----------|
| 交易所不支援 | 交易所不支援條件單 | 手動設定 |
| API 錯誤 | 網路或 API 問題 | 重試或手動設定 |
| 觸發價過近 | 百分比設定過小 | 增加百分比 |

---

## 注意事項

1. **最小百分比**: 建議停損至少設定 0.5% 以上，避免因價格波動立即觸發
2. **市價執行**: 停損停利使用市價單執行，確保成交但可能有滑點
3. **獨立執行**: 停損和停利獨立觸發，一邊觸發不會自動取消另一邊
4. **交易所執行**: 條件單由交易所負責監控和執行，系統不再介入
