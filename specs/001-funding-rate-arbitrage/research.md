# Research & Technical Decisions: 跨交易所資金費率套利平台

**Created**: 2025-10-17
**Feature**: [spec.md](./spec.md)

## 摘要

本研究針對跨交易所資金費率套利平台進行全面的技術選型評估。經過深入分析,核心決策如下:

1. **程式語言**: 選擇 **TypeScript + Node.js**,因其優異的非同步處理能力、豐富的交易所 SDK 生態系統、以及適合即時交易系統的 WebSocket 支援
2. **交易所 SDK**: 採用 **官方 SDK (binance-connector-node + okx-node-sdk)** 搭配 **ccxt** 作為備援,確保 WebSocket 穩定性和完整的永續合約功能支援
3. **資料儲存**: 選擇 **PostgreSQL + TimescaleDB 擴展 + Redis**,兼顧時序資料查詢效能和關聯式資料完整性
4. **雙邊交易執行**: 採用 **Saga Pattern (樂觀執行 + 補償機制)**,適合分散式交易環境的最終一致性需求
5. **監控與告警**: 使用 **Telegram Bot** 作為主要通知管道,搭配 **Prometheus + Grafana** 進行系統監控
6. **風險管理**: 採用 **Fixed Fraction** 倉位管理、**固定比例止損** 策略,以及基於統計的異常檢測機制

---

## Decision 1: 程式語言與執行環境

### 決策
**TypeScript 5.x + Node.js 20.x LTS**

### 理由
- **非同步處理優勢**: Node.js 的事件驅動架構天生適合處理多個交易所的並發 WebSocket 連線和 API 請求,不需要額外的執行緒管理
- **交易所 SDK 成熟度**: Binance 和 OKX 都提供官方的 Node.js SDK,且社群維護的 ccxt 函式庫對 JavaScript/TypeScript 支援最完整
- **WebSocket 生態系統**: Node.js 擁有成熟的 WebSocket 函式庫 (ws, socket.io),適合建立穩定的即時資料串流
- **開發效率**: TypeScript 提供型別安全,減少執行期錯誤,同時保持 JavaScript 的開發速度
- **生態系統豐富**: npm 擁有大量金融、數學計算、監控相關的套件,加速開發流程
- **部署簡單**: 容器化部署方便,記憶體占用適中,適合 24/7 長期運行

### 替代方案評估

#### Python 3.11+
- **優點**:
  - 資料科學函式庫豐富 (pandas, numpy),適合歷史資料分析
  - ccxt 對 Python 支援良好
  - 語法簡潔,開發速度快
- **缺點**:
  - 非同步處理 (asyncio) 相對複雜,需要仔細管理事件迴圈
  - 官方 SDK 支援不如 Node.js 完整 (如 Binance 官方主推 Node.js 和 Python,但 Node.js 版本更新更快)
  - WebSocket 長連線穩定性略遜於 Node.js
  - 型別檢查需要額外的 mypy 配置,不如 TypeScript 原生支援
- **不選擇的原因**: 套利系統的核心是即時交易執行,而非數據分析。Node.js 在處理並發 WebSocket 連線和低延遲交易執行方面更有優勢。Python 更適合作為離線分析和回測工具。

---

## Decision 2: 交易所 SDK 選擇

### 決策
**主要使用官方 SDK,搭配 ccxt 作為備援**

- **Binance**: binance-connector-node (官方)
- **OKX**: okx-node-sdk (官方)
- **備援**: ccxt (統一介面)

### 理由
- **WebSocket 即時數據**: 官方 SDK 提供最穩定和最新的 WebSocket API 實作,支援資金費率即時推送
- **完整的永續合約功能**: 官方 SDK 對永續合約 (Futures/Perpetual) 的支援最完整,包括開倉、平倉、保證金管理等
- **限流處理**: 官方 SDK 內建限流處理邏輯,自動管理請求速率,降低被交易所封鎖風險
- **錯誤恢復機制**: 官方 SDK 提供更詳細的錯誤碼和重連機制
- **維護活躍度**: 交易所官方維護,API 變更時能最快更新
- **備援策略**: ccxt 提供統一介面,在官方 SDK 出問題時可快速切換,增加系統韌性

### 替代方案評估

#### 僅使用 ccxt
- **優點**:
  - 統一的 API 介面,減少學習成本
  - 支援 100+ 交易所,方便未來擴展
  - 社群活躍,文件完整
  - 內建限流和錯誤處理
- **缺點**:
  - WebSocket 支援依賴 ccxt.pro (需付費授權),免費版僅支援 REST API
  - 永續合約功能在某些交易所上支援不完整
  - API 回應速度可能略慢於官方 SDK (多一層抽象)
  - 交易所 API 更新時,ccxt 可能有延遲
- **不選擇的原因**: 資金費率監控需要 WebSocket 即時推送,ccxt 免費版不支援 WebSocket,而 ccxt.pro 需要額外授權費用。官方 SDK 在 WebSocket 和永續合約支援上更可靠。

#### 僅使用官方 REST API (自行封裝)
- **優點**:
  - 完全掌控 API 呼叫邏輯
  - 沒有第三方依賴風險
  - 可針對特定需求優化
- **缺點**:
  - 開發成本高,需要處理簽名、限流、錯誤處理等細節
  - WebSocket 實作複雜,需要處理心跳、重連、訊息解析
  - 維護成本高,交易所 API 變更時需要自行更新
  - 測試覆蓋難度大
- **不選擇的原因**: 重複造輪子,開發和維護成本過高,無法專注於核心套利邏輯。官方 SDK 已經處理好這些基礎設施問題。

---

## Decision 3: 資料儲存方案

### 決策
**PostgreSQL 15+ with TimescaleDB Extension + Redis 7.x**

### 理由
- **時序資料優化**: TimescaleDB 是 PostgreSQL 的擴展,提供高效的時序資料查詢,適合儲存資金費率歷史記錄
- **關聯式資料完整性**: PostgreSQL 支援 ACID 交易,適合儲存交易記錄、對沖部位等需要關聯查詢的資料
- **單一資料庫**: TimescaleDB 是 PostgreSQL 的擴展而非獨立資料庫,減少維護成本
- **自動分區**: TimescaleDB 自動處理時序資料分區 (Hypertable),查詢老舊資料不影響效能
- **快取層**: Redis 用於快取最新資金費率、套利機會、風險參數等熱資料,減少資料庫查詢壓力
- **Pub/Sub 功能**: Redis 可作為事件訊息佇列,處理套利機會通知、交易執行等非同步任務
- **生態系統**: PostgreSQL 和 Redis 都有成熟的 Node.js 驅動 (pg, ioredis),整合方便

### 替代方案評估

#### InfluxDB 2.x + PostgreSQL
- **優點**:
  - InfluxDB 專為時序資料設計,查詢效能優異
  - 內建降採樣和資料保留策略
  - 視覺化工具整合良好
- **缺點**:
  - 需要維護兩個獨立的資料庫系統
  - InfluxDB 不支援關聯式查詢,複雜的交易記錄查詢需要在應用層處理
  - InfluxDB 2.x 的 Node.js 客戶端相對不成熟
  - 增加系統複雜度和維護成本
- **不選擇的原因**: 本專案的資料量在初期不會太大 (3 個幣別,兩個交易所),TimescaleDB 的效能已足夠,不需要引入額外的專用時序資料庫。統一使用 PostgreSQL 可降低運維複雜度。

#### MongoDB + Redis
- **優點**:
  - Schema-less,資料結構變更靈活
  - 水平擴展能力強
  - JSON 文件儲存,與 JavaScript 整合自然
- **缺點**:
  - 無 ACID 交易保證 (雖有 Multi-Document Transaction,但效能較差)
  - 時序資料查詢效能不如 TimescaleDB
  - 複雜的關聯查詢需要在應用層處理或使用 aggregation pipeline
  - 對於金融交易資料,關聯式資料庫的完整性保證更重要
- **不選擇的原因**: 套利系統需要嚴格的資料一致性,PostgreSQL 的 ACID 保證更適合。MongoDB 的靈活性在本專案中不是關鍵需求。

#### 純 Redis (持久化模式)
- **優點**:
  - 極高的讀寫效能
  - 簡化架構,只需維護一個資料儲存系統
  - 支援多種資料結構 (Hash, Sorted Set, Stream)
- **缺點**:
  - 記憶體成本高,不適合長期儲存大量歷史資料
  - 持久化機制 (RDB/AOF) 在故障時可能遺失部分資料
  - 複雜查詢能力有限,不支援 SQL
  - 不適合需要嚴格 ACID 保證的交易記錄
- **不選擇的原因**: 套利系統需要長期保存交易歷史和資金費率資料供分析使用,純記憶體資料庫成本過高且風險較大。Redis 更適合作為快取和訊息佇列。

---

## Decision 4: 雙邊交易執行策略

### 決策
**Saga Pattern (樂觀執行 + 補償機制)**

### 理由
- **分散式交易特性**: 兩個交易所是獨立的系統,無法實現真正的分散式交易 (2PC),Saga 更適合
- **效能優先**: 樂觀執行可降低延遲,在偵測到套利機會時立即執行,不需要預先鎖定資源
- **補償機制**: 當單邊失敗時,透過反向交易補償已成功的一邊,符合金融交易的實務做法
- **最終一致性**: 套利系統可接受短暫的不一致狀態,最終透過補償達到一致即可
- **實作簡單**: 相對於 2PC,Saga 不需要協調者和準備階段,實作和維護成本較低
- **錯誤處理清晰**: 每個步驟的補償動作明確 (開倉失敗 → 平倉另一邊,部分成交 → 調整對沖數量)

### 實作流程
1. **Phase 1 - 執行**: 同時向兩個交易所發送開倉訂單
2. **Phase 2 - 驗證**: 檢查兩邊訂單是否都成功,記錄實際成交數量
3. **Phase 3 - 補償** (若需要):
   - 若一邊完全失敗 → 立即平倉成功的一邊
   - 若兩邊部分成交數量不一致 → 平倉多餘的部位或補足缺少的部位
   - 若兩邊都失敗 → 記錄失敗原因,不需補償

### 替代方案評估

#### 2PC (Two-Phase Commit)
- **優點**:
  - 提供強一致性保證
  - 理論上可確保原子性 (all or nothing)
- **缺點**:
  - 交易所 API 不支援兩階段提交協議
  - 需要在準備階段鎖定資源,但交易所無法提供這種機制
  - 協調者單點故障風險
  - 網路延遲會導致鎖定時間過長,套利機會可能消失
  - 實作複雜度高,需要處理超時、協調者故障等情況
- **不選擇的原因**: 交易所 API 不支援預留訂單或鎖定資金的機制,無法實現真正的 2PC。即使自行實作協調邏輯,也會因為網路延遲導致套利時效性喪失。

#### 悲觀鎖定 + 預檢查
- **優點**:
  - 執行前確認所有條件,降低失敗率
  - 邏輯相對簡單
- **缺點**:
  - 預檢查到實際執行之間有時間差,市場狀態可能改變
  - 無法真正鎖定交易所的資源 (餘額、流動性)
  - 增加延遲,降低套利成功率
  - 仍然需要處理執行階段的失敗情況
- **不選擇的原因**: 預檢查無法保證執行時的成功,仍需要補償機制。在套利場景下,速度比預檢查更重要,預檢查反而增加延遲降低套利成功率。

#### 串行執行 + 回滾
- **優點**:
  - 實作最簡單
  - 確保第一筆成功後再執行第二筆
- **缺點**:
  - 串行執行延遲高,第一筆成功到第二筆執行之間,市場可能變化
  - 第一筆成功但第二筆失敗時,仍需要平倉第一筆 (本質上還是補償)
  - 無法利用並發優勢,降低套利時效性
  - 先執行哪一邊會影響風險 (若選擇先執行費率高的一邊,失敗時損失較大)
- **不選擇的原因**: 套利機會轉瞬即逝,串行執行會增加 5-10 秒延遲,大幅降低套利成功率。且本質上仍需要補償機制,不如直接使用 Saga Pattern。

---

## Decision 5: 監控與告警機制

### 決策

#### 通知方式: **Telegram Bot**
#### 監控工具: **Prometheus + Grafana**

### 理由

#### Telegram Bot
- **即時性**: 訊息推送延遲通常 < 1 秒,適合即時套利通知
- **易於使用**: 使用者只需加入 Bot,無需安裝額外 App
- **豐富的互動**: 支援按鈕、內嵌鍵盤,可提供快速操作介面 (如一鍵停止交易)
- **免費且穩定**: Telegram Bot API 完全免費,無訊息數量限制
- **開發簡單**: Node.js 有成熟的 telegraf 或 node-telegram-bot-api 函式庫
- **多媒體支援**: 可發送圖表、截圖等,方便展示套利機會

#### Prometheus + Grafana
- **行業標準**: 雲原生監控的事實標準,生態系統成熟
- **時序資料**: Prometheus 專為時序指標設計,適合監控交易延遲、API 回應時間等
- **視覺化強大**: Grafana 提供豐富的圖表類型和儀表板
- **告警規則**: Prometheus AlertManager 可設定複雜的告警規則
- **輕量級**: 資源消耗低,適合與交易系統部署在同一台機器
- **自托管**: 完全控制資料,無需擔心第三方服務隱私問題
- **Node.js 整合**: prom-client 函式庫可輕鬆匯出指標

### 監控指標設計
- **系統健康**: API 連線狀態、WebSocket 連線數、錯誤率
- **交易效能**: 雙邊開倉延遲、訂單成功率、滑價統計
- **業務指標**: 套利機會數量、已開倉部位數、累積收益
- **風險指標**: 總保證金使用率、最大單邊部位、異常事件數

### 替代方案評估

#### Email 通知
- **優點**:
  - 正式且有記錄
  - 支援附件和 HTML 格式
  - 無需額外 App
- **缺點**:
  - 延遲較高 (通常幾秒到幾分鐘)
  - 不適合即時互動
  - 可能被歸類為垃圾郵件
  - 使用者不一定會即時查看
- **不選擇的原因**: 套利機會需要即時通知,Email 延遲過高且使用者不會持續監控信箱。更適合日報、週報等非即時通知。

#### Webhook (推送到自定義端點)
- **優點**:
  - 高度靈活,可整合任何第三方服務
  - 適合系統間整合
  - 可自定義處理邏輯
- **缺點**:
  - 需要使用者自行建置接收端點
  - 對一般使用者不友善
  - 需要處理端點失敗、重試等問題
  - 無現成的使用者介面
- **不選擇的原因**: 本專案目標使用者是個人或小型團隊,需要簡單易用的通知方式。Webhook 更適合企業級系統整合,對個人使用者門檻過高。

#### 雲服務監控 (CloudWatch, DataDog, New Relic)
- **優點**:
  - 功能完整,開箱即用
  - 專業的告警和視覺化
  - 自動擴展,無需維護
  - 提供 APM、日誌整合等進階功能
- **缺點**:
  - 按用量計費,長期成本高
  - 資料儲存在第三方,有隱私疑慮
  - 部分功能需要安裝 Agent,增加系統複雜度
  - 對於小型專案,功能過於豐富 (over-engineering)
- **不選擇的原因**: 本專案初期規模小,自托管 Prometheus + Grafana 已足夠,且完全免費。雲服務監控更適合需要多區域部署、大規模日誌分析的企業級應用。

#### Discord Bot
- **優點**:
  - 與 Telegram 類似的即時通知能力
  - 支援豐富的 Embed 訊息格式
  - 適合團隊協作 (頻道、角色權限)
- **缺點**:
  - 在亞洲地區使用者較少
  - Bot 需要加入伺服器,設定略複雜
  - API 限流較嚴格
- **不選擇的原因**: Telegram 在全球尤其亞洲地區使用者更多,且 API 更寬鬆。除非團隊已經使用 Discord,否則 Telegram 是更好的選擇。

---

## Decision 6: 風險管理最佳實踐

### 決策

#### 倉位管理: **Fixed Fraction (固定比例)**
#### 止損策略: **固定比例止損 + 時間止損**
#### 異常檢測: **統計基準 + 規則引擎**

### 理由與實作策略

### 6.1 倉位管理演算法

**選擇 Fixed Fraction**

- **實作方式**: 每次交易使用總資金的固定百分比 (建議 2-5%)
- **公式**: `交易金額 = 總資金 × 固定比例 × 槓桿倍數`
- **優點**:
  - 簡單易懂,易於實作和測試
  - 自動適應帳戶規模,資金增長時倉位也增長
  - 風險可控,單次最大損失有上限
  - 適合套利這種勝率高但單次收益低的策略
- **配置建議**:
  - 保守型: 2% (適合新手或測試階段)
  - 平衡型: 3-4% (適合穩定運行)
  - 激進型: 5% (僅在充分測試後使用)

**不採用 Kelly Criterion 的原因**:
- Kelly 公式需要準確的勝率和賠率估計,但套利場景下這些參數難以準確預測
- Kelly 傾向於激進的倉位配置,在估計偏差時容易導致過大損失
- 計算複雜度高,需要大量歷史資料回測
- 套利策略的收益率相對穩定,不需要動態優化倉位

### 6.2 止損策略設計

**採用雙重止損機制**

#### 固定比例止損
- **觸發條件**: 資金費率差異反轉超過設定閾值 (如 0.1%)
- **實作邏輯**:
  ```
  IF (當前費率差 × 反轉方向) > 止損閾值 THEN
    立即平倉雙邊部位
    記錄止損事件
  END IF
  ```
- **優點**: 防止資金費率反轉導致的持續虧損

#### 時間止損
- **觸發條件**: 持倉時間超過設定週期 (如 24 小時或 3 個資金費率結算週期)
- **實作邏輯**: 即使尚未達到收益目標,也在時間到期時平倉
- **優點**: 防止資金長期鎖定,提高資金使用效率

**不採用 Trailing Stop 的原因**:
- 資金費率套利的收益主要來自費率結算,而非價格波動
- Trailing Stop 更適合趨勢交易,不適合中性套利策略
- 實作複雜度高,需要持續追蹤最高收益點
- 可能在正常的市場波動中過早觸發止損

### 6.3 異常檢測機制

**採用多層次異常檢測**

#### Layer 1: 滑價異常檢測
- **基準**: 計算過去 100 筆交易的平均滑價和標準差
- **觸發**: 當前滑價 > 平均值 + 3 × 標準差
- **動作**: 暫停自動交易,發送警告通知,等待人工確認

#### Layer 2: 流動性檢測
- **基準**: 檢查訂單簿深度,確保在目標交易金額下滑價 < 0.1%
- **觸發**: 盤口流動性不足以支撐目標交易金額
- **動作**: 降低交易金額或跳過本次套利機會

#### Layer 3: API 異常檢測
- **監控指標**:
  - API 回應時間 > 5 秒
  - 連續 3 次請求失敗
  - WebSocket 斷線重連次數 > 5 次/小時
- **動作**:
  - 切換到備用 API 端點
  - 暫停自動交易
  - 發送系統異常通知

#### Layer 4: 資金費率異常檢測
- **基準**: 資金費率突然變化超過歷史 95 百分位數
- **觸發**: 可能是資料錯誤或市場極端事件
- **動作**: 暫停交易,等待下一個週期確認資料正確性

### 實作優先順序
1. **固定比例倉位管理** (Phase 1 - 核心功能)
2. **固定比例止損** (Phase 1 - 核心功能)
3. **滑價和流動性檢測** (Phase 2 - 穩定性提升)
4. **時間止損** (Phase 2 - 穩定性提升)
5. **API 異常檢測** (Phase 3 - 可靠性強化)
6. **資金費率異常檢測** (Phase 3 - 可靠性強化)

---

## Technology Stack Summary

| 項目 | 選擇 | 版本 |
|------|------|------|
| 語言 | TypeScript | 5.3+ |
| 執行環境 | Node.js LTS | 20.x |
| 套件管理 | pnpm | 8.x |
| 交易所 SDK (Binance) | binance-connector-node | 3.x |
| 交易所 SDK (OKX) | okx-node-sdk | 1.x |
| 備援 SDK | ccxt | 4.x |
| 資料庫 | PostgreSQL + TimescaleDB | 15+ / 2.13+ |
| 快取 / 訊息佇列 | Redis | 7.x |
| ORM | Prisma | 5.x |
| WebSocket 函式庫 | ws | 8.x |
| HTTP 客戶端 | axios | 1.6+ |
| 測試框架 | Vitest | 1.x |
| E2E 測試 | Playwright | 1.40+ |
| 監控 (指標) | Prometheus + prom-client | - |
| 監控 (視覺化) | Grafana | 10.x |
| 通知 | Telegram Bot API (telegraf) | 4.x |
| 日誌 | winston | 3.x |
| 程序管理 | PM2 | 5.x |
| 容器化 | Docker + Docker Compose | - |

---

## Implementation Considerations

### 開發優先順序

#### Phase 1: 核心監控與資料收集 (Week 1-2)
1. 建立專案結構和開發環境
2. 整合 Binance 和 OKX 官方 SDK
3. 實作 WebSocket 連線和資金費率即時監控
4. 建立 PostgreSQL + TimescaleDB 資料庫 schema
5. 實作資金費率差異計算和套利機會偵測
6. 整合 Telegram Bot 基礎通知功能

#### Phase 2: 交易執行與風險控制 (Week 3-4)
1. 實作雙邊開倉邏輯 (Saga Pattern)
2. 實作訂單失敗補償機制
3. 實作固定比例倉位管理
4. 實作固定比例止損策略
5. 建立交易記錄和對沖部位管理
6. 整合 Redis 快取和訊息佇列

#### Phase 3: 自動化與可靠性 (Week 5-6)
1. 實作自動平倉邏輯
2. 實作滑價和流動性檢測
3. 實作 API 異常檢測和自動重試
4. 整合 Prometheus + Grafana 監控
5. 建立完整的日誌系統
6. 實作 graceful shutdown 和錯誤恢復

#### Phase 4: 測試與優化 (Week 7-8)
1. 單元測試 (目標覆蓋率 > 80%)
2. 整合測試 (模擬交易所 API 回應)
3. E2E 測試 (使用交易所測試網路)
4. 效能測試 (壓力測試 WebSocket 連線)
5. 回測歷史資料驗證策略
6. 文件撰寫和部署腳本

### 已知風險與緩解措施

#### 風險 1: 交易所 API 限流
- **描述**: 頻繁請求可能觸發交易所限流,導致無法獲取資料或執行交易
- **緩解**:
  - 使用 WebSocket 代替輪詢,減少 REST API 請求
  - 實作請求速率控制 (Rate Limiter)
  - 使用官方 SDK 內建的限流處理
  - 準備多個 API Key 輪替使用 (需確認交易所規則)

#### 風險 2: 網路延遲導致套利失敗
- **描述**: 從偵測機會到執行交易之間,市場狀態可能改變
- **緩解**:
  - 部署在低延遲的雲服務節點 (如 AWS Tokyo/Singapore)
  - 使用 WebSocket 即時資料,減少資料延遲
  - 設定合理的套利閾值,預留滑價和延遲空間
  - 記錄並分析失敗案例,持續優化閾值

#### 風險 3: 單邊訂單失敗導致風險部位
- **描述**: 雙邊交易中一邊成功一邊失敗,產生未對沖的部位
- **緩解**:
  - 實作完整的 Saga 補償機制
  - 設定訂單執行超時 (如 5 秒),超時立即補償
  - 建立單邊部位告警,立即通知使用者
  - 提供手動平倉介面供緊急處理

#### 風險 4: 資料庫故障導致狀態遺失
- **描述**: 資料庫故障可能導致交易記錄或部位狀態遺失
- **緩解**:
  - 使用 PostgreSQL 的 WAL 和 PITR 備份
  - 關鍵操作前先寫入日誌檔案
  - 啟動時從交易所 API 同步當前部位狀態
  - 定期備份資料庫 (每日全備份 + WAL 增量)

#### 風險 5: 極端市場事件 (如交易所暫停交易)
- **描述**: 某交易所暫停特定幣別交易,導致無法平倉
- **緩解**:
  - 監控交易所公告 (可透過 WebSocket 或 RSS)
  - 設定總倉位上限,避免過度集中
  - 建立緊急平倉計畫 (如接受較大滑價強制平倉)
  - 記錄異常事件,供事後分析

#### 風險 6: 私鑰或 API Key 洩露
- **描述**: API Key 洩露可能導致資金被盜
- **緩解**:
  - 使用環境變數或加密配置檔儲存 API Key
  - API Key 權限設定為僅交易,不允許提現
  - 設定 IP 白名單限制
  - 定期輪替 API Key
  - 監控異常登入和交易行為

### Next Steps

#### 立即行動 (Phase 1 準備)
1. **環境設定**:
   - 安裝 Node.js 20.x, PostgreSQL 15, Redis 7
   - 設定 pnpm 和 TypeScript 專案
   - 註冊 Binance 和 OKX 測試網路帳號

2. **API 研究**:
   - 閱讀 Binance Futures API 文件 (WebSocket 和 REST)
   - 閱讀 OKX Perpetual Swap API 文件
   - 測試 API Key 建立和權限設定
   - 研究資金費率 WebSocket 訂閱方式

3. **資料庫設計**:
   - 設計 funding_rates, arbitrage_opportunities, hedge_positions, trade_records 等表格 schema
   - 規劃 TimescaleDB hypertable 配置
   - 設計 Redis 快取 key 結構

4. **架構設計**:
   - 繪製系統架構圖
   - 定義模組邊界 (監控、交易、風控、通知)
   - 設計事件流和資料流
   - 規劃錯誤處理和日誌策略

#### 驗證點 (在開始實作前確認)
- [ ] 已成功連線 Binance 和 OKX 測試網路
- [ ] 已驗證 WebSocket 可接收資金費率即時更新
- [ ] 已確認測試網路可執行永續合約開倉/平倉
- [ ] 已建立 PostgreSQL + TimescaleDB 測試資料庫
- [ ] 已建立 Telegram Bot 並測試訊息推送
- [ ] 已確認所有必要的 npm 套件版本相容性

#### 潛在優化方向 (Phase 5+)
1. **多交易所擴展**: 支援 Bybit, Bitget 等其他交易所
2. **更多幣別**: 擴展到前 20 大市值幣別
3. **機器學習優化**: 使用 ML 預測最佳開倉/平倉時機
4. **回測平台**: 建立完整的策略回測和模擬系統
5. **Web 管理介面**: 提供視覺化的監控和管理介面
6. **多帳戶管理**: 支援管理多個交易所帳戶
7. **風險分散**: 自動在多個套利機會間分配資金

---

**文件版本**: 1.0
**最後更新**: 2025-10-17
**下一步**: 開始 Phase 1 實作,建立專案基礎架構
