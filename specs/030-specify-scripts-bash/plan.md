# Implementation Plan: 追蹤記錄累計收益 Tooltip 明細

**Branch**: `030-specify-scripts-bash` | **Date**: 2025-12-02 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/030-specify-scripts-bash/spec.md`

## Summary

在歷史追蹤記錄表格的「累計收益」欄位加入滑鼠懸停 Tooltip，顯示開倉價格、關倉價格、結算次數和資費收益明細，讓用戶無需進入詳情頁即可快速查看收益組成。

## Technical Context

**Language/Version**: TypeScript 5.6 + Node.js 20.x LTS
**Primary Dependencies**: React 18, Next.js 14 App Router, Radix UI Tooltip (已安裝)
**Storage**: N/A（純前端功能，資料已存在於 API 回應中）
**Testing**: Jest + React Testing Library
**Target Platform**: Web Browser (Chrome, Firefox, Safari)
**Project Type**: Web application
**Performance Goals**: Tooltip 顯示延遲 < 300ms
**Constraints**: 無額外套件安裝需求
**Scale/Scope**: 影響單一組件 (TrackingHistoryTable)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Trading Safety First | ✅ N/A | 純顯示功能，不涉及交易邏輯 |
| II. Complete Observability | ✅ N/A | 不涉及關鍵操作日誌 |
| III. Defensive Programming | ✅ Pass | 處理 null/undefined 價格資料顯示 N/A |
| IV. Data Integrity | ✅ Pass | 使用現有 API 資料，無新增資料模型 |
| V. Incremental Delivery | ✅ Pass | 獨立 UI 功能，可單獨測試 |
| VI. System Architecture Boundaries | ✅ Pass | Web 端只讀取 DB 資料顯示，符合規範 |

**Gate Result**: ✅ PASS - 所有原則皆符合或不適用

## Project Structure

### Documentation (this feature)

```
specs/030-specify-scripts-bash/
├── plan.md              # This file
├── spec.md              # Feature specification
├── quickstart.md        # Implementation guide
├── checklists/
│   └── requirements.md  # Specification quality checklist
└── tasks.md             # Task list (generated by /speckit.tasks)
```

### Source Code (repository root)

```
app/(dashboard)/simulated-tracking/
├── page.tsx                    # 頁面組件 - 更新 interface
└── components/
    └── TrackingHistoryTable.tsx  # 主要修改檔案 - 加入 Tooltip
```

**Structure Decision**: 現有 Next.js App Router 結構，僅修改 simulated-tracking 相關組件

## Complexity Tracking

*無違規項目，不需要複雜度追蹤*

## Implementation Approach

### 資料來源確認

API 已回傳所有需要的欄位（從 `SimulatedTrackingRepository.toResponse()`）：

| 欄位 | 類型 | 說明 |
|------|------|------|
| `initialLongPrice` | `Decimal \| null` | 做多開倉價格 |
| `initialShortPrice` | `Decimal \| null` | 做空開倉價格 |
| `exitLongPrice` | `Decimal \| null` | 做多關倉價格 |
| `exitShortPrice` | `Decimal \| null` | 做空關倉價格 |
| `totalSettlements` | `number` | 結算次數 |
| `fundingPnl` | `Decimal \| null` | 資費損益 |
| `pricePnl` | `Decimal \| null` | 幣價損益 |

### UI 設計

Tooltip 內容結構：
```
收益明細
─────────────────────
開倉價格：$xxx / $xxx
關倉價格：$xxx / $xxx
結算次數：N 次
─────────────────────
資費收益：+$xx.xx
幣價損益：+$xx.xx（若有）
```

### 技術實作

1. 使用 `@radix-ui/react-tooltip` 元件
2. 設定 `delayDuration={300}` 符合成功標準 SC-001
3. 深色背景 (`bg-gray-900`) + 白色文字提升可讀性
4. 收益/損失使用綠/紅色區分

## Phase 0: Research

*無需研究 - 所有技術元件已存在於專案中*

## Phase 1: Design

*無需額外設計 - 使用現有資料結構和 UI 元件庫*
