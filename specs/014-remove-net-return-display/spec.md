# Feature Specification: 移除淨收益欄位，改為獨立參考指標顯示

**Feature Branch**: `014-remove-net-return-display`
**Created**: 2025-01-17
**Status**: Draft
**Input**: User description: "移除淨收益欄位顯示，改為分別顯示資金費率差、價差、預估手續費（0.05% × 4）三個獨立指標，並建立專案手續費計算規範文件"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看獨立參考指標進行套利判斷 (Priority: P1)

交易者在市場監控頁面查看資金費率套利機會時，能夠看到資金費率差、價差、預估手續費三個獨立的參考指標，而不是一個可能誤導的「淨收益」數值。這讓交易者可以根據自己的持倉策略（短期或長期）自行判斷是否存在套利空間。

**Why this priority**: 這是核心功能，直接影響用戶對套利機會的判斷準確性。移除誤導性的淨收益計算可以避免用戶做出錯誤決策。

**Independent Test**: 可以通過訪問市場監控頁面，驗證表格中顯示資金費率差、價差、預估手續費三個欄位，且不再顯示「淨收益」欄位來測試。

**Acceptance Scenarios**:

1. **Given** 用戶訪問市場監控頁面，**When** 查看資金費率表格，**Then** 應該看到「資金費率差」、「價差」、「預估手續費」三個獨立欄位
2. **Given** 用戶查看資金費率表格，**When** 檢查所有欄位，**Then** 不應該看到「淨收益」欄位
3. **Given** 用戶查看某個交易對的數據，**When** 檢查預估手續費欄位，**Then** 應該顯示 0.2% 或相關的固定手續費值
4. **Given** 用戶查看資金費率差為 0.5%、價差為 0.15% 的交易對，**When** 評估套利機會，**Then** 用戶可以根據自己的持倉週期（8 小時、24 小時等）自行計算潛在收益

---

### User Story 2 - 理解手續費成本結構 (Priority: P2)

交易者需要清楚了解套利交易的手續費成本結構，包括建倉做多、建倉做空、平倉做多、平倉做空四筆交易各自的手續費，以便更準確地評估交易成本。

**Why this priority**: 透明的成本結構幫助用戶更精確地計算潛在收益，但相對於核心的指標顯示功能是次要的。

**Independent Test**: 可以通過點擊預估手續費欄位的說明圖示，查看顯示的手續費明細（4 筆 Taker 交易各 0.05%）來測試。

**Acceptance Scenarios**:

1. **Given** 用戶查看預估手續費欄位，**When** 點擊說明或 Tooltip 圖示，**Then** 應該看到詳細的手續費計算明細
2. **Given** 用戶查看手續費明細，**When** 檢查計算方式，**Then** 應該看到：建倉做多 (Taker 0.05%) + 建倉做空 (Taker 0.05%) + 平倉做多 (Taker 0.05%) + 平倉做空 (Taker 0.05%) = 總計 0.2%
3. **Given** 用戶查看手續費明細，**When** 檢查費率類型，**Then** 所有交易都應標示為 Taker fee（不使用 Maker fee）

---

### User Story 3 - 開發者查閱手續費計算規範 (Priority: P3)

開發者或維護人員需要查閱專案的手續費計算規範文件，以了解系統如何計算套利交易的手續費，以及相關的假設和標準。

**Why this priority**: 這是文件化需求，對開發和維護很重要，但對終端用戶價值較低。

**Independent Test**: 可以通過查閱專案文件（如 docs/ 或 specs/ 目錄），找到手續費計算規範文件並驗證其內容完整性來測試。

**Acceptance Scenarios**:

1. **Given** 開發者需要了解手續費計算方式，**When** 查閱專案文件，**Then** 應該能找到清楚說明手續費標準的文件
2. **Given** 開發者閱讀手續費規範文件，**When** 查看計算公式，**Then** 應該看到明確的公式：總手續費 = 0.05% × 4 = 0.2%
3. **Given** 開發者閱讀手續費規範文件，**When** 查看費率類型說明，**Then** 應該看到明確說明「所有交易統一使用 Taker fee，不使用 Maker fee」

---

### Edge Cases

- 當資金費率差為負值時，預估手續費仍應正確顯示為 0.2%
- 當價差為 0 時，三個指標應該仍然獨立顯示，不應影響彼此
- 當用戶對表格進行排序時，移除淨收益欄位後不應影響其他欄位的排序功能
- 當 WebSocket 推送新數據時，三個獨立指標應該同步更新

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系統必須移除市場監控頁面中的「淨收益」欄位顯示
- **FR-002**: 系統必須在市場監控頁面中顯示「預估手續費」欄位，固定顯示 0.2%（或 0.05% × 4 的計算結果）
- **FR-003**: 預估手續費欄位必須提供 Tooltip 或說明，顯示詳細的手續費計算明細（建倉做多、建倉做空、平倉做多、平倉做空各 0.05%）
- **FR-004**: 系統必須移除所有依賴「淨收益」計算的 UI 邏輯，包括顏色編碼（綠/黃/紅）和高收益機會標記（⭐）
- **FR-005**: 系統必須更新高收益機會的判斷邏輯，改為基於資金費率差（例如 spreadPercent > 0.5%）而非淨收益
- **FR-006**: 系統必須移除後端 API 和 WebSocket 中關於淨收益的計算邏輯
- **FR-007**: 系統必須保留資金費率差和價差的顯示，這些欄位不受此次變更影響
- **FR-008**: 系統必須建立手續費計算規範文件，明確定義套利交易的手續費標準
- **FR-009**: 手續費計算規範文件必須說明：所有交易（建倉做多、建倉做空、平倉做多、平倉做空）統一使用 Taker fee 計算
- **FR-010**: 手續費計算規範文件必須說明：標準 Taker fee 為 0.05%，總手續費為 0.05% × 4 = 0.2%
- **FR-011**: 系統必須移除未使用的淨收益計算相關代碼（如 net-return-calculator.ts）
- **FR-012**: 系統必須更新表格排序功能，移除「淨收益」排序選項

### Key Entities

- **預估手續費 (Fee Estimate)**: 表示完成一次套利交易（包含建倉和平倉）的總手續費成本，固定為 0.2%
- **手續費明細 (Fee Breakdown)**: 包含四筆交易的詳細手續費：建倉做多 (0.05%)、建倉做空 (0.05%)、平倉做多 (0.05%)、平倉做空 (0.05%)
- **手續費計算規範 (Fee Calculation Standard)**: 專案文件，定義套利交易的手續費計算方式和相關假設

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用戶訪問市場監控頁面時，能清楚看到資金費率差、價差、預估手續費三個獨立的參考指標
- **SC-002**: 市場監控頁面中不再顯示「淨收益」欄位或任何依賴淨收益計算的 UI 元素（顏色編碼、高收益標記等）
- **SC-003**: 用戶點擊預估手續費說明時，能看到詳細的手續費計算明細（4 筆 Taker 交易）
- **SC-004**: 開發者能在專案文件中找到清楚的手續費計算規範，包含公式、費率類型和相關假設
- **SC-005**: 系統代碼庫中不再包含未使用的淨收益計算邏輯，減少維護成本
- **SC-006**: 表格排序和篩選功能正常運作，不受移除淨收益欄位的影響
- **SC-007**: WebSocket 實時數據更新時，三個獨立指標能正確同步顯示最新數據

## Assumptions

- 手續費計算假設所有交易使用 Taker fee（0.05%），不考慮 Maker fee 或不同會員等級的費率
- 手續費計算假設每次套利交易包含 4 筆交易：建倉做多、建倉做空、平倉做多、平倉做空
- 移除淨收益欄位不影響用戶的核心套利評估能力，因為用戶可以根據三個獨立指標自行判斷
- 現有的資金費率差和價差欄位已經正確實現，無需修改其計算邏輯

## Out of Scope

- 支援不同交易所的不同手續費率（統一使用 0.05% Taker fee）
- 支援不同會員等級的手續費優惠（統一使用標準費率）
- 提供多週期淨收益計算功能（如 1 天、7 天、30 天持倉的收益計算）
- 支援 Maker fee 計算（統一使用 Taker fee）
- 提供手續費計算器或模擬工具
- 修改後端資料庫 schema（如移除 ArbitrageResult 表中的 net_profit 欄位，該欄位用於其他功能）
