# 監控多個交易對使用指南

本文件說明如何使用 CLI 監控服務監控多個交易對，支援三種方式。

## 方式一：自動從交易所 API 獲取（推薦）

自動獲取 Binance 和 OKX 兩個交易所都支援的所有 USDT 永續合約交易對，並依據交易量過濾。

### 基本用法

```bash
# 自動獲取所有交易對（預設最小交易量 100 萬 USDT）
pnpm cli monitor start --auto-fetch

# 自訂最小交易量（例如：500 萬 USDT）
pnpm cli monitor start --auto-fetch --min-volume 5000000
```

### 優點
- ✅ 自動獲取最新的交易對列表
- ✅ 依據交易量過濾，只監控活躍的交易對
- ✅ 只監控兩個交易所都支援的交易對（確保可套利）
- ✅ 無需手動維護交易對列表

### 運作流程

1. 從 Binance Futures API 獲取所有 USDT 永續合約
2. 從 OKX Swap API 獲取所有 USDT 永續合約
3. 檢查每個交易對的 24 小時交易量
4. 過濾掉交易量低於門檻的交易對
5. 取兩個交易所的交集
6. 按字母順序排序後開始監控

### 示例輸出

```
正在從交易所獲取可用交易對...
Binance 可用交易對: 127
OKX 可用交易對: 108
兩個交易所共同支援的交易對: 95

✅ 自動獲取到 95 個交易對（最小交易量 >= 1,000,000 USDT）
📋 交易對: BTCUSDT, ETHUSDT, BNBUSDT, SOLUSDT, XRPUSDT, ADAUSDT, DOGEUSDT, AVAXUSDT, DOTUSDT, MATICUSDT ... 等 95 個
```

---

## 方式二：使用配置檔案群組

從 `config/symbols.json` 載入預定義的交易對群組。

### 可用群組

| 群組名稱 | 說明 | 交易對數量 |
|---------|------|-----------|
| `top10` | 市值前 10 大幣種 | 10 個 |
| `top20` | 市值前 20 大幣種 | 20 個 |
| `defi` | DeFi 相關幣種 | 8 個 |
| `layer1` | Layer 1 公鏈 | 10 個 |
| `meme` | Meme 幣 | 5 個 |
| `default` | 預設監控組 | 3 個 |

### 用法

```bash
# 監控市值前 10 大幣種
pnpm cli monitor start -g top10

# 監控 DeFi 相關幣種
pnpm cli monitor start -g defi

# 監控 Meme 幣
pnpm cli monitor start -g meme
```

### 自訂群組

編輯 `config/symbols.json` 新增自己的群組：

```json
{
  "groups": {
    "my_favorites": {
      "name": "我的最愛",
      "symbols": [
        "BTCUSDT",
        "ETHUSDT",
        "SOLUSDT",
        "LINKUSDT"
      ]
    }
  }
}
```

然後使用：

```bash
pnpm cli monitor start -g my_favorites
```

---

## 方式三：手動指定交易對

直接在命令列指定要監控的交易對。

### 用法

```bash
# 監控 3 個交易對
pnpm cli monitor start -s "BTCUSDT,ETHUSDT,SOLUSDT"

# 監控 10 個交易對
pnpm cli monitor start -s "BTCUSDT,ETHUSDT,BNBUSDT,SOLUSDT,XRPUSDT,ADAUSDT,DOGEUSDT,AVAXUSDT,DOTUSDT,MATICUSDT"
```

### 適用情境
- 只想監控特定幾個交易對
- 臨時測試某些交易對
- 不想使用配置檔案

---

## 效能考量

### 監控交易對數量建議

| 交易對數量 | 建議更新間隔 | 記憶體使用 | API 呼叫頻率 |
|----------|-------------|-----------|-------------|
| 1-10 個 | 5 秒 | ~100 MB | 正常 |
| 11-30 個 | 10 秒 | ~150 MB | 中等 |
| 31-50 個 | 15 秒 | ~200 MB | 較高 |
| 51-100 個 | 30 秒 | ~300 MB | 很高 |
| 100+ 個 | 60 秒 | ~500 MB | 極高 ⚠️ |

### 調整更新間隔

```bash
# 監控 50 個交易對，使用 15 秒更新間隔
pnpm cli monitor start --auto-fetch --min-volume 5000000 -i 15000

# 監控 100 個交易對，使用 30 秒更新間隔
pnpm cli monitor start --auto-fetch --min-volume 2000000 -i 30000
```

### API 速率限制

- **Binance**: 每分鐘 1200 個請求
- **OKX**: 每 2 秒 20 個請求

計算公式：
```
每次更新的 API 呼叫 = 交易對數量 × 2（兩個交易所）
每分鐘的 API 呼叫 = 每次更新的 API 呼叫 × (60 / 更新間隔秒數)
```

範例：
- 50 個交易對，5 秒更新間隔 = 50 × 2 × 12 = 1200 次/分鐘（接近上限 ⚠️）
- 50 個交易對，15 秒更新間隔 = 50 × 2 × 4 = 400 次/分鐘（安全 ✅）

---

## 完整命令範例

### 範例 1：保守策略（推薦給新手）

```bash
# 只監控市值前 10 大，5 秒更新
pnpm cli monitor start -g top10
```

### 範例 2：積極策略（尋找更多機會）

```bash
# 自動獲取所有交易量 > 200 萬的交易對，15 秒更新
pnpm cli monitor start --auto-fetch --min-volume 2000000 -i 15000
```

### 範例 3：專注某類別

```bash
# 只監控 DeFi 相關幣種
pnpm cli monitor start -g defi
```

### 範例 4：極致覆蓋（需要高效能主機）

```bash
# 監控所有交易量 > 100 萬的交易對，30 秒更新
pnpm cli monitor start --auto-fetch --min-volume 1000000 -i 30000
```

---

## 常見問題

### Q: 監控太多交易對會怎樣？

A: 可能遇到以下問題：
1. 記憶體使用增加
2. CPU 使用率上升
3. API 速率限制錯誤
4. 資料庫寫入壓力增加

**建議**：根據主機效能調整，一般建議監控 10-30 個交易對。

### Q: 如何知道哪些交易對最活躍？

A: 使用 `--auto-fetch` 搭配較高的 `--min-volume`：

```bash
# 只監控交易量 > 1000 萬的交易對
pnpm cli monitor start --auto-fetch --min-volume 10000000
```

### Q: 可以同時監控測試網和正式網嗎？

A: 不行，每次只能監控一個環境。建議分別執行兩個監控服務實例。

```bash
# 終端 1: 正式網
pnpm cli monitor start --auto-fetch

# 終端 2: 測試網
pnpm cli monitor start --auto-fetch --testnet
```

### Q: 交易對列表會自動更新嗎？

A:
- **手動指定** (-s)：不會，需要重啟服務
- **配置檔案** (-g)：不會，需要重啟服務
- **自動獲取** (--auto-fetch)：不會自動更新，但下次重啟時會重新獲取最新列表

---

## 監控輸出

所有方式都會在終端顯示即時監控表格：

```
┌─────────┬──────────────┬──────────────┬──────────┬──────────────┬────────────┐
│ Symbol  │ Binance Rate │ OKX Rate     │ Diff     │ Annual ROI   │ Status     │
├─────────┼──────────────┼──────────────┼──────────┼──────────────┼────────────┤
│ BTCUSDT │ 0.0100%      │ 0.0150%      │ 0.0050%  │ 5.48%        │            │
│ ETHUSDT │ 0.0200%      │ 0.0700%      │ 0.0500%  │ 54.75%       │ 🔔 機會    │
│ SOLUSDT │ 0.0150%      │ 0.0180%      │ 0.0030%  │ 3.29%        │            │
└─────────┴──────────────┴──────────────┴──────────┴──────────────┴────────────┘
```

發現機會時會：
1. 終端顯示機會報告
2. 寫入資料庫
3. 透過 WebSocket 推送給前端
4. 記錄到日誌檔案

---

## 最佳實踐

1. **生產環境**：使用 `--auto-fetch` 搭配適當的 `--min-volume`
2. **開發測試**：使用 `-g` 載入小型群組
3. **臨時測試**：使用 `-s` 手動指定
4. **高頻監控**：減少交易對數量或增加更新間隔
5. **尋找機會**：增加交易對數量，但適度調整更新間隔

記得定期監控系統資源使用情況！
