# 交易手續費計算規範

## 概述

本文件定義了套利交易平台的手續費計算標準和假設，用於確保整個系統對交易成本的估算保持一致。

## 手續費計算公式

### 套利交易總手續費

```
總手續費 = 0.05% × 4 = 0.2%
```

### 交易明細

一次完整的套利操作涉及 4 筆交易，每筆交易均使用 **Taker Fee** 計算：

| 交易類型 | 說明 | 手續費率 |
|---------|------|---------|
| 建倉做多 (Long Open) | 在低費率交易所開多倉 | 0.05% |
| 建倉做空 (Short Open) | 在高費率交易所開空倉 | 0.05% |
| 平倉做多 (Long Close) | 平掉多倉 | 0.05% |
| 平倉做空 (Short Close) | 平掉空倉 | 0.05% |
| **總計** | | **0.20%** |

## 費率類型說明

### Taker Fee vs Maker Fee

- **Taker Fee**：立即成交的市價單，從訂單簿中"拿走"流動性
- **Maker Fee**：掛單等待成交的限價單，為訂單簿"提供"流動性

### 為什麼統一使用 Taker Fee？

本系統的手續費估算統一使用 Taker Fee (0.05%) 進行計算，原因如下：

1. **保守估算**：Taker fee 通常高於 Maker fee，使用 Taker fee 計算可確保不會低估成本
2. **執行確定性**：套利機會稍縱即逝，使用市價單（Taker）可確保立即成交
3. **簡化計算**：統一費率標準，避免複雜的條件判斷

## 實際費率參考

各交易所的實際費率可能因 VIP 等級、交易量而有所不同。以下是標準費率參考：

### Binance (幣安)
- Maker Fee: 0.02%
- Taker Fee: 0.05%

### OKX (歐易)
- Maker Fee: 0.02%
- Taker Fee: 0.05%

### MEXC
- Maker Fee: 0.00%
- Taker Fee: 0.06%

### Gate.io
- Maker Fee: 0.015%
- Taker Fee: 0.05%

**注意**：實際費率以各交易所官網公告為準。本系統使用 0.05% 作為統一的 Taker Fee 估算值。

## 重要假設

### 1. 費率假設
- 所有交易均視為 Taker 訂單
- 統一使用 0.05% 作為每筆交易的手續費率
- 不考慮 VIP 等級折扣或返佣

### 2. 交易週期假設
- 完整套利操作包含開倉和平倉兩個階段
- 每個階段涉及兩個交易所（做多和做空）
- 共計 4 筆獨立交易

### 3. 滑點假設
- 本手續費計算不包含滑點成本
- 實際交易時需額外考慮市場深度和滑點影響

## 計算範例

### 範例 1：基本套利機會

**假設條件**：
- 資金費率差異：0.8%
- 價差：+0.1%（有利）
- 預估手續費：0.2%

**成本分析**：
```
每筆交易成本 = 交易金額 × 0.05%

假設交易金額 = 10,000 USDT

建倉做多成本：10,000 × 0.05% = 5 USDT
建倉做空成本：10,000 × 0.05% = 5 USDT
平倉做多成本：10,000 × 0.05% = 5 USDT
平倉做空成本：10,000 × 0.05% = 5 USDT

總手續費：20 USDT (= 10,000 × 0.2%)
```

### 範例 2：手續費比率計算

**計算方式**：
```
手續費佔比 = (總手續費 / 交易金額) × 100%
           = (4 × 0.05%)
           = 0.2%
```

## 系統實現

### 前端顯示

市場監控頁面的「預估手續費」欄位統一顯示 **0.2%**，並提供 Tooltip 說明明細。

相關元件：
- `app/(dashboard)/market-monitor/components/FeeEstimateTooltip.tsx`
- `app/(dashboard)/market-monitor/components/RatesTable.tsx`
- `app/(dashboard)/market-monitor/components/RateRow.tsx`

### 後端計算

後端服務不計算淨收益，僅提供原始的費率差異、價差等獨立指標，由前端顯示預估手續費。

## 相關文件

- [Feature 014 規格文件](../specs/014-remove-net-return-display/spec.md)
- [Feature 014 技術計劃](../specs/014-remove-net-return-display/plan.md)

## 更新紀錄

| 日期 | 版本 | 變更說明 |
|-----|------|---------|
| 2025-01-18 | 1.0.0 | 初始版本，定義手續費計算標準 |

---

**注意事項**：
1. 本文件定義的是「預估」手續費，實際交易成本可能因市場條件而有所不同
2. 開發新功能時，應參照此文件確保手續費計算的一致性
3. 如需調整手續費計算規則，應更新此文件並同步更新相關程式碼
